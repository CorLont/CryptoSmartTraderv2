# Overview
CryptoSmartTrader V2 is an institutional-grade multi-agent cryptocurrency trading intelligence system designed to achieve significant financial returns (500% target validation). It integrates quantitative strategies, real-time market analysis, deep learning, sentiment analysis, and technical analysis to provide robust backtesting, automated trade execution, advanced risk management, and comprehensive observability for volatile crypto markets. The project's ambition is to deliver a highly reliable, high-performance trading system capable of operating in production environments.

# User Preferences
Preferred communication style: Simple, everyday language.
Data integrity policy: ABSOLUTE ZERO-TOLERANCE for synthetic/fallback data - Complete elimination of all non-authentic data sources in production mode. Only 100% authentic data from direct exchange APIs allowed. Production automatically blocks any violations. No fallback, no synthetic data, no interpolated values, no NaN values allowed in production. Strict data integrity enforcement with real-time validation and automatic production blocking.
Repository priorities: P0 (CI/lint/type/tests/security optimized with GitHub Actions, uv caching, Python matrix testing, security scanning), P1 (multi-service Replit config documented, CODEOWNERS with @clont1 approval requirements, branch protection with required PR flow), P2 (comprehensive test strategy with fixtures, property-based testing, deterministic time, smart test markers)
Recent improvements: BUILD-BREAKER VOLLEDIG OPGELOST - All 27 syntax errors eliminated achieving 100% syntactically valid codebase (413/413 files), python -m compileall passes cleanly, 23 problematic modules quarantined to experiments/ with stub replacements, eliminated 3 duplicate core classes (ExecutionPolicy, RiskGuard, PrometheusMetrics), upgraded deprecated GitHub Actions (upload-artifact@v3→v4), fixed security issues (direct os.environ access), enterprise dashboard stable on port 5000, SECURITY HARDENING COMPLETED - 30 security fixes applied (pickle→JSON migration in 26 files, subprocess hardening in 4 files), eliminated arbitrary code execution risks, added timeout protection, OBSERVABILITY CENTRALIZED - Consolidated scattered Prometheus metrics from 9+ files into single observability/metrics.py with consistent naming (orders_sent/filled, latency_ms, slippage_bps, equity, drawdown_pct, signals_received), thread-safe singleton pattern, context managers and decorators for automation, EXECUTION DISCIPLINE IMPLEMENTED - Hard requirement that ALL orders pass through ExecutionPolicy.decide() with mandatory gates (spread/depth/volume/slippage validation), idempotent client_order_id generation, double-order prevention with network timeout protection, post-only enforcement, comprehensive test suite validating concurrent scenarios, CENTRALIZED RISK GUARD COMPLETED - Hard risk management for ALL trades with day-loss ($10k), max drawdown (5%), exposure ($100k), position limits (10 max), data-gap detection (5min max), automatic kill-switch activation with emergency halt, comprehensive logging/alerting, persistent state management, thread-safe portfolio tracking, integration with execution discipline system, VOL-TARGETING KELLY SIZING COMPLETED - Fractional Kelly criterion (25% fraction) with volatility targeting (15% portfolio vol), correlation-based position limits (20% single asset, 40% cluster), asset clustering (CRYPTO_MAJOR/ALT/DEFI/LAYER1/LAYER2), portfolio optimization (Kelly+MVO, risk parity), transaction cost awareness, full integration with risk guard and execution discipline, REGIME-SWITCHING SYSTEM COMPLETED - Advanced market regime detection (trending/mean-revert/choppy/high-vol/breakout/consolidation) with automatic parameter adaptation, stops/TP/sizing/throttle adjustment per regime, confidence-based filtering, technical indicators (trend strength, choppiness index, realized volatility, mean reversion score), adaptive trading manager with entry throttling, full integration with existing sizing/risk/execution systems, BACKTEST-LIVE PARITY COMPLETED - Advanced execution simulation modeling fees/partial-fills/latency/queue effects, comprehensive tracking error calculation in basis points, daily reporting with component attribution (slippage/fees/timing/latency), auto-disable mechanism when drift >100 bps, emergency alerting system, persistent state management, multi-strategy support with threshold-based monitoring
Repository structure: ENTERPRISE PACKAGE LAYOUT COMPLETED - Clean src/cryptosmarttrader/ package structure, comprehensive pyproject.toml configuration, enterprise .gitignore excluding logs/, models/, runs/, exports/, *.egg-info/, and modern tooling integration (pytest, mypy, bandit, coverage) all configured in pyproject.toml. Single clear package import path with proper artifact control. DUPLICATE IMPLEMENTATIONS FULLY CONSOLIDATED - Single source of truth per user specifications: RiskGuard (src/cryptosmarttrader/risk/), ExecutionPolicy (src/cryptosmarttrader/execution/), PrometheusMetrics (src/cryptosmarttrader/observability/) with backward-compatible aliases preventing import conflicts and module drift. All services operational with clean import structure. Module drift risk eliminated.
CI/CD Infrastructure: ENTERPRISE CI/CD PIPELINE COMPLETED - Complete GitHub Actions workflow with UV package management, Python 3.11/3.12 matrix testing, intelligent uv.lock caching, multi-stage pipeline (Security→Test→Quality→Deploy), comprehensive security scanning (gitleaks, pip-audit, bandit, OSV, CodeQL), branch protection with required status checks, CODEOWNERS with @clont1 approval requirements, automated release pipeline with version validation, coverage gates with --cov-fail-under=70, concurrency controls, artifact management, daily security monitoring, and Dependabot automated updates. All actions up-to-date (@v4/@v5), hard enforcement (no fallbacks), and production-ready deployment automation. CI/CD MODERNIZATION COMPLETED - All deprecated GitHub Actions upgraded (upload-artifact@v3→v4, setup-python@v4→v5), split quality checks with clear failures, coverage gates enforced across all workflows, enterprise-grade pipeline with timeout controls and artifact retention.
Testing infrastructure: ENTERPRISE TEST SUITE COMPLETED - Comprehensive unit tests (sizing, risk guard, execution policy), integration tests (exchange adapters, API health, backtest parity), E2E smoke tests (service startup, health endpoints), with strict pytest.ini configuration, marker system (unit/integration/slow/api/ml/trading/security/performance), 70%+ coverage targets, and automated test runner with quality gates integration. Backtest-live parity validation with <20 bps/day tracking error assertion implemented.
Repository hygiene: Enterprise .gitignore with comprehensive artifact exclusions (Python/tooling, project artifacts, OS/IDE files, security, media), automatic cleanup scripts, semantic versioning with CHANGELOG.md, release asset management.
Replit deployment: Multi-service architecture with Dashboard (5000), API (8001), Metrics (8000), health endpoints, proper service orchestration, process isolation. UV-based startup pattern: `uv sync && (service1 & service2 & service3 & wait)` for optimal Replit compatibility. Health endpoint returns 200 OK, waitForPort=5000 configured, parallel process execution verified operational.
Container & Runtime: ENTERPRISE DOCKER CONFIGURATION COMPLETED - Multi-stage production Dockerfile with pinned python:3.11.10-slim-bookworm base image, non-root trader user (UID 1000), comprehensive health checks every 30s, Docker Compose with monitoring stack (Prometheus + Grafana), complete Kubernetes manifests with liveness/readiness/startup probes, Pydantic Settings fail-fast configuration, automated deployment scripts, and comprehensive observability with alert rules. All ports documented (5000/8001/8000), security hardened with capability dropping, resource limits enforced.

# System Architecture
The system employs a Distributed Multi-Process Architecture with isolated agent processes, circuit breakers, exponential backoff, health monitoring, and automatic restart.

## Key Architectural Decisions
*   **Deployment & Structure:** Uses a lean 3-script deployment approach and a multi-service architecture with a clean `src/` structure, enterprise package layout, and clean architecture principles (domain interfaces/ports and swappable adapters), semantic versioning, and enterprise `.gitignore`.
*   **Foundational Services:** Includes comprehensive testing (unit, integration, E2E), enterprise security (secrets management, log sanitization), production-grade structured JSON logging, Pydantic configuration with fail-fast checks, async I/O with global rate limiting, intelligent caching, and health monitoring. Automated CI/CD pipelines use GitHub Actions for security, testing, quality, and deployment.
*   **Data & Exchange Management:** Features multi-exchange integration with a real-time data pipeline, strict data integrity filters (zero-tolerance for non-authentic data), timestamp synchronization, and temporal validation/feature engineering. Full Kraken coverage and live data validation are implemented.
*   **Regime Detection & Strategy Adaptation:** Employs advanced market regime classification (6 types) using Hurst exponent, ADX/volatility/market breadth analysis, ML-powered classification, and regime-adaptive trading strategies.
*   **Machine Learning & AI:** Leverages GPU optimization, multi-horizon ML, uncertainty quantification, continual learning, automated feature engineering, reinforcement learning, Human-in-the-Loop & explainability, advanced transformers, conformal prediction, probability calibrator, and regime-aware models. Includes a comprehensive model registry with versioning, automated retraining triggers with canary deployment, and drift detection with rollback automation. An ML ensemble optimizer uses dynamic model weights and regime-adaptive strategies.
*   **Ensemble & Meta-Learning:** Utilizes an alpha-stacking architecture combining orthogonal information sources (TA, Sentiment, Regime), a meta-learner, sophisticated feature engineering, time series cross-validation, probability calibration, alpha blending, signal decay management, and consensus mechanisms with dynamic model weights and regime-adaptive strategies.
*   **Trading & Risk Management:** Implements an 80% confidence gate, shadow trading, advanced execution simulation, enterprise portfolio risk management (hard caps, correlation limits, kill-switch with progressive escalation, daily loss limits, max-drawdown limits, position size controls, order idempotency & deduplication). RiskGuard and ExecutionPolicy systems are fully implemented and hard-wired to prevent bypass.
*   **Execution & Alpha Preservation:** Features a comprehensive liquidity gating system with spread/depth/volume thresholds, real-time spread monitoring, slippage tracking and budget enforcement, an integrated execution filter with idempotent order IDs, market microstructure analysis, order book depth analysis, and execution quality scoring. Supports advanced order types like TWAP and Iceberg.
*   **Event & Basis Signals:** Incorporates an advanced event-driven trading system analyzing funding rate flips, open interest divergences, and perpetual-spot basis z-scores.
*   **Backtest-Live Parity System:** Provides advanced execution simulation to eliminate performance illusions, including latency modeling, market microstructure simulation, comprehensive fee structures, and daily parity reporting with <20 bps tracking error targets, with drift detection and component attribution analysis. Includes daily tracking error monitoring and an auto-disable system.
*   **Hyperparameter Tuning & OOS Validation:** Uses an advanced optimization system with Bayesian optimization and robust out-of-sample validation, featuring walk-forward and regime-aware cross-validation.
*   **Return Attribution Dashboard:** Offers an advanced PnL decomposition system splitting returns into alpha, fees, slippage, timing, and sizing components, alongside real-time performance monitoring and degradation detection.
*   **UI/UX & Monitoring:** Features an enterprise Streamlit dashboard with performance optimization, async data refresh, intelligent caching, modular page architecture, and session state management. Integrated Prometheus monitoring and AlertManager provide comprehensive observability with alert rules.
*   **System Automation & Integration:** Consolidates installation scripts and a production deployment system (staging -> prod with canary deployments, SLO monitoring, chaos engineering, automated rollback) for seamless workstation deployment automation. All components (RiskGuard, ExecutionPolicy, Kelly sizing, regime detection) are strictly integrated via a DataFlowOrchestrator and IntegratedTradingEngine with a zero-tolerance data policy.

## Technology Stack
*   **Frontend:** Streamlit.
*   **Backend:** Python, FastAPI.
*   **Machine Learning:** PyTorch, scikit-learn, XGBoost, LightGBM.
*   **Data Processing:** pandas, numpy, CuPy, Numba.
*   **Exchange Integration:** CCXT.
*   **Visualization:** Plotly.
*   **Storage:** Local file system (JSON/CSV) with caching.

# External Dependencies
*   **AI/ML Services:** OpenAI API
*   **Cryptocurrency Exchanges:** Kraken
*   **Monitoring:** Prometheus